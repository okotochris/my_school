<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Update Primary Result</title>
    <link rel="stylesheet" type="text/css" href="styles/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="./admin">Back to Admin</a>
        </nav>
    </header>
    <div class="platform">
        <h2>UPDATE PRIMARY RESULT</h2>
    </div>
    <div class="upload_result">
        <form id="updateForm" method="POST" enctype="multipart/form-data">
            <fieldset class="studentInfo">
                <legend>STUDENT INFO:</legend>
                <div class="student-info-grid">
                    <input type="text" placeholder="First Name Middle Name Last Name" name="userName" id="userName" readonly />
                    <input type="text" placeholder="Student ID" name="studentId" id="studentId" required />
                    <button type="button" style="width:100px; font-size:14px;" id="getDetails">Get Details</button>
                </div>
                <div id="respond" style="color:red; text-align: center; margin: 0.5rem 0;"></div>
                <div class="term-class-grid">
                    <label>CLASS</label>
                    <select name="class" id="Sclass" required>
                        <option value="" disabled selected>Select Class</option>
                        <option value="BASIC 1">BASIC 1</option>
                        <option value="BASIC 2">BASIC 2</option>
                        <option value="BASIC 3">BASIC 3</option>
                        <option value="BASIC 4">BASIC 4</option>
                        <option value="BASIC 5">BASIC 5</option>
                        <option value="BASIC 6">BASIC 6</option>
                    </select>
                    <label>SCHOOL TERM</label>
                    <select id="Sterm" name="term" required>
                        <option value="" disabled selected>Select Term</option>
                        <option value="FIRST TERM">FIRST TERM</option>
                        <option value="SECOND TERM">SECOND TERM</option>
                        <option value="THIRD TERM">THIRD TERM</option>
                    </select>
                </div>
            </fieldset>

            <fieldset>
                <legend>RESULT INFO:</legend>
                <!-- English Language -->
                <div class="subject-row">
                    <input type="text" value="English Language" name="eng" id="eng" readonly />
                    <input type="number" placeholder="1st Test" name="eng1st" id="eng1st" oninput="calculateSubject('eng')" />
                    <input type="number" placeholder="2nd Test" name="eng2nd" id="eng2nd" oninput="calculateSubject('eng')" />
                    <input type="number" id="engca" name="engca" placeholder="CCA" oninput="calculateSubject('eng')" />
                    <input type="number" placeholder="Exam" name="engexam" id="engexam" oninput="calculateSubject('eng')" />
                    <input type="text" placeholder="TOTAL SCORE" name="engscore" id="engscore" readonly />
                    <input type="text" placeholder="GRADE" name="engG" id="engG" readonly />
                    <input type="text" name="engRemark" id="engRemark" placeholder="Remark" readonly />
                </div>
                <!-- Mathematics -->
                <div class="subject-row">
                    <input type="text" value="Mathematics" name="mth" id="mth" readonly />
                    <input type="number" placeholder="1st Test" name="mth1st" id="mth1st" oninput="calculateSubject('mth')" />
                    <input type="number" placeholder="2nd Test" name="mth2nd" id="mth2nd" oninput="calculateSubject('mth')" />
                    <input type="number" id="mthca" name="mthca" placeholder="CCA" oninput="calculateSubject('mth')" />
                    <input type="number" placeholder="Exam" name="mthexam" id="mthexam" oninput="calculateSubject('mth')" />
                    <input type="text" placeholder="TOTAL SCORE" name="mthscore" id="mthscore" readonly />
                    <input type="text" placeholder="GRADE" name="mthG" id="mthG" readonly />
                    <input type="text" name="mthRemark" id="mthRemark" placeholder="Remark" readonly />
                </div>
                <!-- Christian Religion Studies -->
                <div class="subject-row">
                    <input type="text" value="Christian Religion Studies" name="rnv" id="rnv" readonly />
                    <input type="number" placeholder="1st Test" name="rnv1st" id="rnv1st" oninput="calculateSubject('rnv')" />
                    <input type="number" placeholder="2nd Test" name="rnv2nd" id="rnv2nd" oninput="calculateSubject('rnv')" />
                    <input type="number" id="rnvca" name="rnvca" placeholder="CCA" oninput="calculateSubject('rnv')" />
                    <input type="number" placeholder="Exam" name="rnvexam" id="rnvexam" oninput="calculateSubject('rnv')" />
                    <input type="text" placeholder="TOTAL SCORE" name="rnvscore" id="rnvscore" readonly />
                    <input type="text" placeholder="GRADE" name="rnvG" id="rnvG" readonly />
                    <input type="text" name="rnvRemark" id="rnvRemark" placeholder="Remark" readonly />
                </div>
                <!-- Basic Science & Technology -->
                <div class="subject-row">
                    <input type="text" value="Basic Science & Technology" name="bst" id="bst" readonly />
                    <input type="number" placeholder="1st Test" name="bst1st" id="bst1st" oninput="calculateSubject('bst')" />
                    <input type="number" placeholder="2nd Test" name="bst2nd" id="bst2nd" oninput="calculateSubject('bst')" />
                    <input type="number" id="bstca" name="bstca" placeholder="CCA" oninput="calculateSubject('bst')" />
                    <input type="number" placeholder="Exam" name="bstexam" id="bstexam" oninput="calculateSubject('bst')" />
                    <input type="text" placeholder="TOTAL SCORE" name="bstscore" id="bstscore" readonly />
                    <input type="text" placeholder="GRADE" name="bstG" id="bstG" readonly />
                    <input type="text" name="bstRemark" id="bstRemark" placeholder="Remark" readonly />
                </div>
                <!-- Edo Language -->
                <div class="subject-row">
                    <input type="text" value="Edo Language" readonly name="pvs" id="pvs"/>
                    <input type="number" placeholder="1st Test" name="pvs1st" id="pvs1st" oninput="calculateSubject('pvs')" />
                    <input type="number" placeholder="2nd Test" name="pvs2nd" id="pvs2nd" oninput="calculateSubject('pvs')" />
                    <input type="number" id="pvsca" name="pvsca" placeholder="CCA" oninput="calculateSubject('pvs')" />
                    <input type="number" placeholder="Exam" name="pvsexam" id="pvsexam" oninput="calculateSubject('pvs')" />
                    <input type="text" placeholder="TOTAL SCORE" name="pvsscore" id="pvsscore" readonly />
                    <input type="text" placeholder="GRADE" name="pvsG" id="pvsG" readonly />
                    <input type="text" name="pvsRemark" id="pvsRemark" placeholder="Remark" readonly />
                </div>
                <!-- Quantitative Reasoning -->
                <div class="subject-row">
                    <input type="text" value="Quantitative Reasoning" readonly name="qur" id="qur"/>
                    <input type="number" placeholder="1st Test" name="qur1st" id="qur1st" oninput="calculateSubject('qur')" />
                    <input type="number" placeholder="2nd Test" name="qur2nd" id="qur2nd" oninput="calculateSubject('qur')" />
                    <input type="number" id="qurca" name="qurca" placeholder="CCA" oninput="calculateSubject('qur')" />
                    <input type="number" placeholder="Exam" name="qurexam" id="qurexam" oninput="calculateSubject('qur')" />
                    <input type="text" placeholder="TOTAL SCORE" name="qurscore" id="qurscore" readonly />
                    <input type="text" placeholder="GRADE" name="qurG" id="qurG" readonly />
                    <input type="text" name="qurRemark" id="qurRemark" placeholder="Remark" readonly />
                </div>
                <!-- Verbal Aptitude -->
                <div class="subject-row">
                    <input type="text" value="Verbal Aptitude" readonly name="ver" id="ver" />
                    <input type="number" placeholder="1st Test" name="ver1st" id="ver1st" oninput="calculateSubject('ver')" />
                    <input type="number" placeholder="2nd Test" name="ver2nd" id="ver2nd" oninput="calculateSubject('ver')" />
                    <input type="number" id="verca" name="verca" placeholder="CCA" oninput="calculateSubject('ver')" />
                    <input type="number" placeholder="Exam" name="verexam" id="verexam" oninput="calculateSubject('ver')" />
                    <input type="text" placeholder="TOTAL SCORE" name="verscore" id="verscore" readonly />
                    <input type="text" placeholder="GRADE" name="verG" id="verG" readonly />
                    <input type="text" name="verRemark" id="verRemark" placeholder="Remark" readonly />
                </div>
                <!-- Pre Vocational Study -->
                <div class="subject-row">
                    <input type="text" value="Pre Vocational Study" id="pvd" id="pvd"  readonly />
                    <input type="number" placeholder="1st Test" name="pvd1st" id="pvd1st" oninput="calculateSubject('pvd')" />
                    <input type="number" placeholder="2nd Test" name="pvd2nd" id="pvd2nd" oninput="calculateSubject('pvd')" />
                    <input type="number" id="pvdca" name="pvdca" placeholder="CCA" oninput="calculateSubject('pvd')" />
                    <input type="number" placeholder="Exam" name="pvdexam" id="pvdexam" oninput="calculateSubject('pvd')" />
                    <input type="text" placeholder="TOTAL SCORE" name="pvdscore" id="pvdscore" readonly />
                    <input type="text" placeholder="GRADE" name="pvdG" id="pvdG" readonly />
                    <input type="text" name="pvdRemark" id="pvdRemark" placeholder="Remark" readonly />
                </div>
                <!-- Numerical Aptitude -->
                <div class="subject-row">
                    <input type="text" value="Numerical Aptitude" name="vst" id="vst" readonly />
                    <input type="number" placeholder="1st Test" name="vst1st" id="vst1st" oninput="calculateSubject('vst')" />
                    <input type="number" placeholder="2nd Test" name="vst2nd" id="vst2nd" oninput="calculateSubject('vst')" />
                    <input type="number" id="vstca" name="vstca" placeholder="CCA" oninput="calculateSubject('vst')" />
                    <input type="number" placeholder="Exam" name="vstexam" id="vstexam" oninput="calculateSubject('vst')" />
                    <input type="text" placeholder="TOTAL SCORE" name="vstscore" id="vstscore" readonly />
                    <input type="text" placeholder="GRADE" name="vstG" id="vstG" readonly />
                    <input type="text" name="vstRemark" id="vstRemark" placeholder="Remark" readonly />
                </div>
                <!-- Cultural & Creative Art -->
                <div class="subject-row">
                    <input type="text" value="Cultural & Creative Art" name="cra" id="cra" readonly />
                    <input type="number" placeholder="1st Test" name="cra1st" id="cra1st" oninput="calculateSubject('cra')" />
                    <input type="number" placeholder="2nd Test" name="cra2nd" id="cra2nd" oninput="calculateSubject('cra')" />
                    <input type="number" id="craca" name="craca" placeholder="CCA" oninput="calculateSubject('cra')" />
                    <input type="number" placeholder="Exam" name="craexam" id="craexam" oninput="calculateSubject('cra')" />
                    <input type="text" placeholder="TOTAL SCORE" name="crascore" id="crascore" readonly />
                    <input type="text" placeholder="GRADE" name="craG" id="craG" readonly />
                    <input type="text" name="craRemark" id="craRemark" placeholder="Remark" readonly />
                </div>
                <!-- National Value -->
                <div class="subject-row">
                    <input type="text" value="National Value" readonly name="spe" id="spe" />
                    <input type="number" placeholder="1st Test" name="spe1st" id="spe1st" oninput="calculateSubject('spe')" />
                    <input type="number" placeholder="2nd Test" name="spe2nd" id="spe2nd" oninput="calculateSubject('spe')" />
                    <input type="number" id="speca" name="speca" placeholder="CCA" oninput="calculateSubject('spe')" />
                    <input type="number" placeholder="Exam" name="speexam" id="speexam" oninput="calculateSubject('spe')" />
                    <input type="text" placeholder="TOTAL SCORE" name="spescore" id="spescore" readonly />
                    <input type="text" placeholder="GRADE" name="speG" id="speG" readonly />
                    <input type="text" name="speRemark" id="speRemark" placeholder="Remark" readonly />
                </div>
                <!-- Hand Writing -->
                <div class="subject-row">
                    <input type="text" value="Hand Writing" readonly name="hwr" id="hwr"/>
                    <input type="number" placeholder="1st Test" name="hwr1st" id="hwr1st" oninput="calculateSubject('hwr')" />
                    <input type="number" placeholder="2nd Test" name="hwr2nd" id="hwr2nd" oninput="calculateSubject('hwr')" />
                    <input type="number" id="hwrca" name="hwrca" placeholder="CCA" oninput="calculateSubject('hwr')" />
                    <input type="number" placeholder="Exam" name="hwrexam" id="hwrexam" oninput="calculateSubject('hwr')" />
                    <input type="text" placeholder="TOTAL SCORE" name="hwrscore" id="hwrscore" readonly />
                    <input type="text" placeholder="GRADE" name="hwrG" id="hwrG" readonly />
                    <input type="text" name="hwrRemark" id="hwrRemark" placeholder="Remark" readonly />
                </div>
                <!-- Phonics (Speech Sci.) -->
                <div class="subject-row">
                    <input type="text" value="Phonics (Speech Sci.)" readonly name="mus" id="mus"/>
                    <input type="number" placeholder="1st Test" name="mus1st" id="mus1st" oninput="calculateSubject('mus')" />
                    <input type="number" placeholder="2nd Test" name="mus2nd" id="mus2nd" oninput="calculateSubject('mus')" />
                    <input type="number" id="musca" name="musca" placeholder="CCA" oninput="calculateSubject('mus')" />
                    <input type="number" placeholder="Exam" name="musexam" id="musexam" oninput="calculateSubject('mus')" />
                    <input type="text" placeholder="TOTAL SCORE" name="musscore" id="musscore" readonly />
                    <input type="text" placeholder="GRADE" name="musG" id="musG" readonly />
                    <input type="text" name="musRemark" id="musRemark" placeholder="Remark" readonly />
                </div>
                <!-- French Language -->
                <div class="subject-row">
                    <input type="text" value="French Language"  name="red" id="red" />
                    <input type="number" placeholder="1st Test" name="red1st" id="red1st" oninput="calculateSubject('red')" />
                    <input type="number" placeholder="2nd Test" name="red2nd" id="red2nd" oninput="calculateSubject('red')" />
                    <input type="number" id="redca" name="redca" placeholder="CCA" oninput="calculateSubject('red')" />
                    <input type="number" placeholder="Exam" name="redexam" id="redexam" oninput="calculateSubject('red')" />
                    <input type="text" placeholder="TOTAL SCORE" name="redscore" id="redscore" readonly />
                    <input type="text" placeholder="GRADE" name="redG" id="redG" readonly />
                    <input type="text" name="redRemark" id="redRemark" placeholder="Remark" readonly />
                </div>
                <!-- History -->
                <div class="subject-row">
                    <input type="text" value="History" id="hst" name="hst" />
                    <input type="number" placeholder="1st Test" name="hst1st" id="hst1st" oninput="calculateSubject('hst')" />
                    <input type="number" placeholder="2nd Test" name="hst2nd" id="hst2nd" oninput="calculateSubject('hst')" />
                    <input type="number" id="hstca" name="hstca" placeholder="CCA" oninput="calculateSubject('hst')" />
                    <input type="number" placeholder="Exam" name="hstexam" id="hstexam" oninput="calculateSubject('hst')" />
                    <input type="text" placeholder="TOTAL SCORE" name="hstscore" id="hstscore" readonly />
                    <input type="text" placeholder="GRADE" name="hstG" id="hstG" readonly />
                    <input type="text" name="hstRemark" id="hstRemark" placeholder="Remark" readonly />
                </div>
                 <div class="subject-row">
                    <input type="text" value="History" id="ped" name="ped" />
                    <input type="number" placeholder="1st Test" name="ped1st" id="ped1st" oninput="calculateSubject('ped')" />
                    <input type="number" placeholder="2nd Test" name="ped2nd" id="ped2nd" oninput="calculateSubject('ped')" />
                    <input type="number" id="pedca" name="pedca" placeholder="CCA" oninput="calculateSubject('ped')" />
                    <input type="number" placeholder="Exam" name="pedexam" id="pedexam" oninput="calculateSubject('ped')" />
                    <input type="text" placeholder="TOTAL SCORE" name="pedscore" id="pedscore" readonly />
                    <input type="text" placeholder="GRADE" name="pedG" id="pedG" readonly />
                    <input type="text" name="pedRemark" id="pedRemark" placeholder="Remark" readonly />
                </div>
            </fieldset>
            <fieldset>
                <legend>STUDENT PERFORMANCE</legend>
                <div class="performance-grid">
                    <div>
                        <label>No. of subjects offered:</label>
                        <input type="text" placeholder="No. of subjects offered" id="No_subj" name="No_subj" readonly />
                    </div>
                    <div>
                        <label>Average score:</label>
                        <input type="text" placeholder="Average score" id="average" name="average" required readonly />
                    </div>
                    <div>
                        <label>Score obtainable:</label>
                        <input type="text" placeholder="Score obtainable" id="score_obtainable" name="score_obtainable" readonly />
                    </div>
                    <div>
                        <label>Total score obtained:</label>
                        <input type="text" id="score_obtain" placeholder="Total score obtained" name="score_obtain" readonly />
                    </div>
                    <button type="button" style="width:100px; font-size:14px;" id="Calc">Compute Scores</button>
                </div>
            </fieldset>
            <fieldset>
                <legend>OTHER INFORMATION</legend>
                <div class="other-info-grid">
                    <select name="section" id="section" required>
                        <option value="" disabled selected>Academic Section</option>
                        <option value="2023 - 2024">2023 - 2024</option>
                        <option value="2024 - 2025" selected>2024 - 2025</option>
                        <option value="2025 - 2026">2025 - 2026</option>
                        <option value="2026 - 2027">2026 - 2027</option>
                    </select>
                    <input type="text" placeholder="Times present" name="present" id="present" />
                    <input type="text" placeholder="Times absent" name="absent" id="absent" />
                    <input type="text" placeholder="Class Teacher Report" id="tReport" name="tReport" />
                    <input type="text" placeholder="Head Teacher Report" name="Treport" id="Treport" readonly />
                    <input type="text" placeholder="Next term resume" name="nextterm" value="6th Jan, 2026" />
                    <select id="promotedto" name="promote">
                        <option value="" disabled selected>Promoted to</option>
                        <option value="BASIC 2">BASIC 2</option>
                        <option value="BASIC 3">BASIC 3</option>
                        <option value="BASIC 4">BASIC 4</option>
                        <option value="BASIC 5">BASIC 5</option>
                        <option value="BASIC 6">BASIC 6</option>
                        <option value="JSS 1">JSS 1</option>
                    </select>
                    <input type="text" placeholder="Outstanding fees" name="fees" id="fees" />
                </div>
            </fieldset>
            <fieldset class="schoolInfo">
                <legend>School Info:</legend>
                <button id="submitbutton" type="submit">Update Result</button>
            </fieldset>
            <p id="upload" style="color:red;"></p>
        </form>
    </div>

    <script>
      
        function showLoading(getDetailsBtn) {
               
                getDetailsBtn.innerHTML = '<span style="display: inline-flex; align-items: center; gap: 0.5rem;">Loading <div style="width: 12px; height: 12px; border: 2px solid #fff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div></span>';
                getDetailsBtn.disabled = true;
        }

        function hideLoading(getDetailsBtn) {
                getDetailsBtn.innerHTML = 'Update Result';
                getDetailsBtn.disabled = false;
        
        }


    let form = document.getElementById('updateForm');
      form.onsubmit = async (e)=> {
            e.preventDefault();
            showLoading(document.getElementById('submitbutton'))
            let formData = new FormData(form);
            const data = Object.fromEntries(formData.entries())
            try {
                let result = await fetch('/update_basic_result', {
                    method: 'PATCH',
                    headers:{'Content-Type':"application/json"},
                    body: JSON.stringify(data)
                });
                let responseText = await result.text();
                if (responseText) {
                    alert(`${responseText}`);
                    if (result.ok) {
                        form.reset(); // Optional: reset after success
                    }
                }
            } catch (err) {
                console.log(err);
                alert('Update failed. Please try again.');
            }finally{
                hideLoading(document.getElementById('submitbutton'))
            }
        }
    </script>

    <script src="js/main.js"></script>
    <script src="primary_score.js"></script>
    <script src="js/fetchResult.js"></script>
</body>
</html>