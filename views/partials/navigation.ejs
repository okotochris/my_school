<!-- Overlay for mobile -->
<div id="navOverlay" class="nav-overlay" onclick="toggleNav()"></div>

<nav class="navigation" id="sideNav">
  <div class="nav-scroll">
    <div class="nav-header">
      <h3>Quick Links</h3>
      <span class="nav-close" onclick="toggleNav()">Ã—</span>
    </div>

    <ul class="nav-list">
      <li><a href="/"><span class="icon">ğŸ«</span> Check Result</a></li>
      <li><a href="/admin"><span class="icon">ğŸ“¤</span> Upload Result</a></li>
      <li><a href="/studentgrade"><span class="icon">ğŸ“˜</span> Student Grade</a></li>
      <li><a href="/studentid"><span class="icon">ğŸ«</span> Get Student ID</a></li>
      <li><a href="/generateid"><span class="icon">ğŸ§¾</span> Register Student</a></li>
      <li><a href="/blacklist"><span class="icon">ğŸš«</span> Blacklist</a></li>
      <% if(role == 'admin'){ %>
        <li><a href="/staffmanagement"><span class="icon">ğŸ‘©â€ğŸ«</span> Staff Management</a></li>
      <%} %>
    </ul>

    <div class="dropdown">
      <button class="dropdown-toggle" onclick="toggleUpdate()">
        <span class="icon">â®Ÿ</span> Make Update
      </button>
      <ul class="dropdown-menu" id="updateMenu">
        <li><a href="/update"><span class="sub-icon">âœ</span> Update Student Info</a></li>
        <li><a href="/update-ss"><span class="sub-icon">ğŸ“Š</span> Update Senior Result</a></li>
        <li><a href="/update-jss"><span class="sub-icon">ğŸ“Š</span> Update Junior Result</a></li>
        <li><a href="/update-basic"><span class="sub-icon">ğŸ“Š</span> Update Basic Result</a></li>
        <li><a href="/update-nursery"><span class="sub-icon">ğŸ“Š</span> Update Nursery Result</a></li>
      </ul>
    </div>

<div class="fees">
    Fees: â‚¦<span id="fee"><%= fees %></span>
</div>
<button type="button" onclick="makePayment()" id="button" 
style="padding:10px; font-size: 18px; background: #3535e0; color:white; border:0px">Make Payment</button>

<script src="https://checkout.flutterwave.com/v3.js"></script>

<script>
  const buttonId = document.getElementById('button')
  async function makePayment() {
    buttonId.innerText = "Loading.."
    const res = await fetch('/payment/schoolinfo')
    if(!res.ok){
      return;
    }
     const data = await res.json()
      buttonId.innerText = "Make Payment"
    const {email, school, user_name } = data.result;
    const fee = data.fee
    if(fee < 100){
      return 
    }
    const amountInNumber = Number(fee);
    const meta = {
        schoolName:  school,
        amount: amountInNumber,
        staffName:user_name,
        refId: `${user_name}${Date.now()}`          
      }
    FlutterwaveCheckout({
      public_key: "FLWPUBK-f8514622db2e398152c1a94f24a478a5-X",
      tx_ref: "SCHL-" + Date.now(), // better unique ref
      amount: amountInNumber,      // use dynamic amount
      currency: "NGN",
      payment_options: "card,ussd,banktransfer",

      customer: {
        email: email,   
        name: user_name,
      },

      callback: function (data) {
        fetch("/api/payment-callback", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            tx_ref: data.tx_ref,
            meta
          })
        })
        .then(res => res.json())
        .then(result => {
          document.getElementById('fee"').innerHTML = 0;
        });
      },

      onclose: function() {
        console.log("Payment closed");
      }
    });
  }
</script>




  </div>
</nav>